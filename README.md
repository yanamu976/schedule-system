# 勤務表自動作成システム (Japanese Shift Scheduling System)

日本の警備業務向けの勤務表自動作成システムです。Google OR-Tools を使用した制約プログラミングにより、複雑な勤務要件を満たすスケジュールを自動生成します。

## 🚀 Live Demo

**Streamlit Cloud デプロイ**: [勤務表自動作成システム](https://schedule-system.streamlit.app)

## ✨ 主要機能

- **🎯 制約プログラミング**: Google OR-Tools CP-SAT ソルバーを使用した最適化
- **📅 複雑なルール対応**: 三徹禁止、二徹制限、月またぎ制約など
- **🏢 複数勤務場所**: 駅A、指令、警乗などの場所別シフト管理
- **📊 Excel出力**: 色分け付きの詳細なExcelファイル生成
- **🎮 リアルタイム最適化**: ゲーミフィケーション機能付き進捗表示
- **🧠 インテリジェント診断**: 制約競合の自動分析と改善提案

## 🛠️ セットアップ

### 依存関係のインストール

```bash
pip install -r requirements.txt
```

### ローカル実行

```bash
streamlit run schedule_gui.py
```

## 📋 使用方法

1. **従業員設定**: サイドバーで従業員名を入力
2. **年月選択**: 対象となる年月を選択
3. **前月末勤務**: 前月末の勤務状況を設定
4. **希望入力**: 
   - カレンダーで有休希望日を選択
   - 自然言語でシフト希望を入力
5. **生成実行**: 「勤務表を生成」ボタンをクリック
6. **結果確認**: 
   - ブラウザ上で勤務表を確認
   - Excelファイルをダウンロード

## 🏗️ システム構成

### 主要クラス

- **`CompleteScheduleEngine`**: 制約プログラミングエンジン
- **`ExcelExporter`**: Excel出力機能
- **`WorkLocationManager`**: 勤務場所管理
- **`GamifiedSolutionCallback`**: リアルタイム最適化表示

### 制約システム

- **基本制約**: 勤務後翌日非番、連続非番禁止
- **業界ルール**: 三徹禁止（3日連続勤務禁止）
- **バランス制約**: 二徹（2日連続勤務）の公平な配分
- **月またぎ**: 前月末勤務状況の考慮

## 📊 出力形式

### Excel シート構成

1. **勤務表**: カラフルな色分け付きメインスケジュール
2. **統計**: 個人別勤務回数・バランス分析
3. **月またぎ分析**: 前月末からの制約影響分析
4. **制約緩和レポート**: 最適化プロセスの詳細

### 色分けシステム

- **🟦 青系**: 通常勤務（駅A、指令、警乗など）
- **🟨 黄色**: 有休・休暇
- **🟥 赤色**: 制約違反・注意が必要な配置
- **🟩 緑色**: 最適化による推奨配置

## ⚙️ 設定ファイル

### `work_locations.json`
勤務場所と色の設定

### `shift_config.json`
シフトタイプと制約の設定

## 🚀 デプロイ

このシステムは Streamlit Cloud にデプロイされており、以下のURLからアクセス可能です：

[https://schedule-system.streamlit.app](https://schedule-system.streamlit.app)

## 🔧 開発・カスタマイズ

### 新しい制約の追加

1. `CompleteScheduleEngine.solve_with_relaxation()` メソッドを編集
2. 新しい制約変数を追加
3. 目的関数に重み付けを設定

### 新しい勤務場所の追加

`work_locations.json` ファイルを編集して新しい場所と色を定義

## 📝 ライセンス

このプロジェクトは個人・商用利用可能です。

## 🤝 貢献

プルリクエストやイシューの報告を歓迎します。

---

**開発者**: Claude Code Assistant  
**技術スタック**: Python, Streamlit, OR-Tools, XlsxWriter  
**最終更新**: 2025年6月7日
